<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <title>Lucky Warp Screen</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <style>
    * {
      box-sizing: border-box;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
    }

    body {
      margin: 0;
      background: radial-gradient(circle at top left, #262c4a 0%, #111320 45%, #050712 100%);
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 32px;
      color: #f9fafb;
    }

    .wrap {
      width: 100%;
      max-width: 1400px;
      height: 80vh;
      max-height: 800px;
      background: rgba(10, 12, 24, 0.9);
      border-radius: 32px;
      display: flex;
      padding: 32px 40px;
      gap: 32px;
      box-shadow:
        0 24px 60px rgba(0,0,0,0.7),
        0 0 0 2px rgba(255,255,255,0.04);
    }

    /* ฝั่งรูปซ้าย */
    .image-panel {
      flex: 0 0 35%;
      display: flex;
      justify-content: center;
      align-items: center;
    }

    .image-frame {
      width: 100%;
      max-width: 430px;
      aspect-ratio: 4 / 5;   /* 1080x1350 (Portrait) */
      border-radius: 32px;
      overflow: hidden;
      background: #050816;
      border: 4px solid rgba(255,255,255,0.15);
      box-shadow: 0 18px 40px rgba(0,0,0,0.8);
    }

    .image-frame img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    /* ฝั่งข้อความขวา */
    .text-panel {
      flex: 1;
      display: flex;
      flex-direction: column;
      justify-content: center;
      gap: 18px;
      padding-right: 32px;
    }

    .ig-header {
      display: flex;
      align-items: center;
      gap: 12px;
      margin-bottom: 8px;
    }

    .ig-logo {
      width: 40px;
      height: 40px;
      border-radius: 12px;
      background: radial-gradient(circle at 30% 30%, #fffbf0 0%, #ff0069 35%, #ff8a00 70%, #ffd600 100%);
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 0 20px rgba(255, 0, 120, 0.7);
    }

    .ig-logo-icon {
      width: 22px;
      height: 22px;
      background: url("https://upload.wikimedia.org/wikipedia/commons/a/a5/Instagram_icon.png") center/cover no-repeat;
      filter: drop-shadow(0 0 4px rgba(0,0,0,0.6));
    }

    .ig-name {
      font-size: 3rem;
      font-weight: 800;
      letter-spacing: 0.02em;
    }

    .message {
      font-size: 2rem;
      line-height: 1.35;
      font-weight: 700;
      color: #ffe66b;
      text-shadow: 0 2px 8px rgba(0,0,0,0.9);
      max-width: 90%;
    }

    .subtag-row {
      margin-top: 18px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 24px;
      opacity: 0.95;
    }

    /* QR Panel */
    .qr-panel {
      display: flex;
      align-items: center;
      gap: 14px;
    }

    .qr-img {
      width: 96px;
      height: 96px;
      border-radius: 16px;
      background: #fff;
      padding: 6px;
      box-shadow: 0 0 18px rgba(0,0,0,0.7);
    }

    .qr-text {
      font-size: 1.05rem;
      line-height: 1.4;
      color: #e5e7eb;
    }

    .qr-text span {
      font-size: 1.25rem;
      font-weight: 800;
      color: #ffb347;
      text-shadow: 0 0 10px rgba(255,179,71,0.7);
      white-space: nowrap;
    }

    .tag-lucky {
      padding: 6px 16px;
      border-radius: 999px;
      font-size: 0.95rem;
      background: linear-gradient(135deg, #ff4b8b, #ffb347);
      color: #111827;
      font-weight: 700;
      box-shadow: 0 0 18px rgba(255,99,132,0.6);
    }

    /* Animation เวลาเปลี่ยนภาพ */
    .fade-in {
      animation: fadeIn 0.6s ease-out;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to   { opacity: 1; transform: translateY(0);   }
    }

    @media (max-width: 900px) {
      .wrap {
        flex-direction: column;
        height: auto;
        max-height: none;
      }
      .image-panel {
        flex: none;
        justify-content: center;
      }
      .text-panel {
        padding-right: 0;
      }
      .ig-name {
        font-size: 2.2rem;
      }
      .message {
        font-size: 1.4rem;
      }
    }
  </style>
</head>

<body>
  <div class="wrap">
    <!-- รูปลูกค้า -->
    <div class="image-panel">
      <div class="image-frame">
        <img id="warp-image" src="" alt="">
      </div>
    </div>

    <!-- ข้อความ + QR -->
    <div class="text-panel">
      <div class="ig-header">
        <div class="ig-logo">
          <div class="ig-logo-icon"></div>
        </div>
        <div class="ig-name" id="warp-ig">@someone</div>
      </div>

      <div class="message" id="warp-message">ข้อความจากลูกค้า...</div>

      <div class="subtag-row">
        <div class="qr-panel">
          <img class="qr-img" src="QR_IMAGE_URL_HERE" alt="QR Warp Form">
          <div class="qr-text">
            แจกวาร์ปขึ้นจอ<br>
            <span>SCAN เลย</span>
          </div>
        </div>

        <div class="tag-lucky">Lucky Warp</div>
      </div>
    </div>
  </div>

  <script>
    // ======= CONFIG =======
    const API_URL = 'https://script.google.com/macros/s/AKfycbyPe0m5QIrapr1sThYjwTHRASCXhrOf9qTMcRwKrNyPfCCdYvOjT7xS5drG7840O6-ztg/exec';   // ← ใส่ Web App URL จาก Apps Script
    const DISPLAY_INTERVAL_MS = 30000;         // แสดงรายการละ 30 วิ
    const REFRESH_INTERVAL_MS = 60000;         // ดึงข้อมูลใหม่ทุก 60 วิ

    let items = [];
    let currentIndex = 0;
    let lastSignature = '';

    const imgEl = document.getElementById('warp-image');
    const igEl  = document.getElementById('warp-ig');
    const msgEl = document.getElementById('warp-message');

    function showEmpty() {
      imgEl.src = '';
      igEl.textContent  = '';
      msgEl.textContent = 'ยังไม่มีวาร์ปในตอนนี้';
    }

    async function fetchData() {
      try {
        const res = await fetch(API_URL + '?t=' + Date.now());
        if (!res.ok) throw new Error('Fetch error');
        let data = await res.json();

        let rows = Array.isArray(data) ? data : [];
        rows = rows.filter(r => (r.status || 'approved') === 'approved');

        rows.sort((a, b) => {
          const ta = a.timestamp ? new Date(a.timestamp).getTime() : 0;
          const tb = b.timestamp ? new Date(b.timestamp).getTime() : 0;
          return ta - tb;
        });

        if (rows.length === 0) {
          if (items.length === 0) showEmpty();
          return;
        }

        const sig = JSON.stringify(
          rows.map(r => (r.timestamp || '') + '|' + (r.ig || '') + '|' + (r.imageUrl || ''))
        );
        if (sig === lastSignature) return;

        items = rows;
        lastSignature = sig;
        currentIndex = 0;
        renderCurrent(true);

      } catch (err) {
        console.error('fetchData error:', err);
      }
    }

    function renderCurrent(withAnim = false) {
      if (!items || items.length === 0) {
        showEmpty();
        return;
      }

      const item = items[currentIndex];

      const ig  = item.ig || '';
      const msg = item.message || '';
      const img = item.imageUrl || '';

      imgEl.src = img;
      igEl.textContent  = ig || '';
      msgEl.textContent = msg || '';

      if (withAnim) {
        [imgEl, igEl, msgEl].forEach(el => {
          el.classList.remove('fade-in');
          void el.offsetWidth;
          el.classList.add('fade-in');
        });
      }

      currentIndex = (currentIndex + 1) % items.length;
    }

    fetchData();
    setInterval(fetchData, REFRESH_INTERVAL_MS);
    setInterval(() => renderCurrent(true), DISPLAY_INTERVAL_MS);
  </script>
</body>
</html>
